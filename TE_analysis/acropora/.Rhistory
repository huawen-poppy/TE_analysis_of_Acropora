#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5)
}
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = 3*pi/2)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2,labelpositionThreshold = 0.8)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2,labelpositionThreshold = 0)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2,labelpositionThreshold = 0.3)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2,labelpositionThreshold = 0.8)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2,labelpositionThreshold = 01)
for (celltype in unique(plot_data$celltype)){
target=plot_data[plot_data$celltype==celltype,]
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5,start = -3*pi/2)
}
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = T,
pieLabelSize = 5,donutLabelSize = 5)
for (celltype in unique(plot_data$celltype)){
target=plot_data[plot_data$celltype==celltype,]
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5)
}
View(plot_data)
head(plot_data)
### plot distance
te_distance=read.csv('./data/same_strain_distance_df_for_plot_remove_duplicate_gene_distance_group_with_label.csv',header = T,row.names = 1)
te_distance=te_distance[,c(2,3,4,5,6,7)]
head(te_distance)
#colnames(te_distance)[1]<-'distance'
te_distance$type<-with(te_distance,ifelse(distance>2000,'Distal','Proximal'))
te_distance$cluster_te=paste0(te_distance$cluster,'_',te_distance$te_id)
#te_distance_input<-te_distance[,c(1,2,6,8)]
te_distance_new=te_distance %>%
group_by(cluster_te) %>%
slice_min(order_by = distance)
te_distance_new<-as.data.frame(te_distance_new)
#te_distance_new$cluster=gsub('_NODE-.*','',te_distance_new$cluster_te)
#te_distance_new$type<-with(te_distance_new,ifelse(distance>2000,'Distal','Proximal'))
te_distance_new<-te_distance_new[!duplicated(te_distance_new$cluster_te),]
#te_distance_new<-te_distance_new[,c(4,5)]
te_distance_new=as.data.frame(te_distance_new)
plot_input=te_distance_new %>%
group_by(cluster,type) %>%
count()
library(plyr)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=n/sum(n)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(n) - 0.5 * n))
plot_input2$label = paste0(sprintf("%.0f", plot_input2$percent), "%")
ggplot(plot_input2, aes(fill=type, y=n, x=cluster)) +
geom_bar(position="stack", stat="identity")+
ylab('Number of TEs')+
theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
RotatedAxis()+
ggtitle('Distance to protein-coding genes')+
#scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5), size = 3.5)
dim(te_distance_new)
head(te_distance)
head(te_distance_new)
### plot distance
te_distance=read.csv('./data/same_strain_distance_df_for_plot_remove_duplicate_gene_distance_group_with_label.csv',header = T,row.names = 1)
te_distance=te_distance[,c(2,3,4,5,6,7)]
head(te_distance)
#colnames(te_distance)[1]<-'distance'
te_distance$type<-with(te_distance,ifelse(distance>5000,'Distal','Proximal'))
te_distance$cluster_te=paste0(te_distance$cluster,'_',te_distance$te_id)
#te_distance_input<-te_distance[,c(1,2,6,8)]
te_distance_new=te_distance %>%
group_by(cluster_te) %>%
slice_min(order_by = distance)
te_distance_new<-as.data.frame(te_distance_new)
length(unique(te_distance_new$te_id))
head(te_distance_new)
#te_distance_new<-te_distance_new[,c(4,5)]
te_distance_new=as.data.frame(te_distance_new)
write.csv(te_distance_new,'./data/marker_te_cloest_genes_distance_5k_all_gene.csv')
plot_input=te_distance_new %>%
group_by(cluster,type) %>%
count()
library(plyr)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=n/sum(n)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(n) - 0.5 * n))
plot_input2$label = paste0(sprintf("%.0f", plot_input2$percent), "%")
ggplot(plot_input2, aes(fill=type, y=n, x=cluster)) +
geom_bar(position="stack", stat="identity")+
ylab('Number of TEs')+
theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
RotatedAxis()+
ggtitle('Distance to protein-coding genes')+
#scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5), size = 3.5)
head(plot_input2)
plot_input=te_distance_new %>%
group_by(cluster,type) %>%
count()
head(plot_input)
library(plyr)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=freq/sum(freq)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(n) - 0.5 * n))
plot_input2<-ddply(plot_input,.(cluster),transform,percent=freq/sum(freq)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(frew) - 0.5 * freq))
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(freq) - 0.5 * freq))
plot_input2$label = paste0(sprintf("%.0f", plot_input2$percent), "%")
ggplot(plot_input2, aes(fill=type, y=freq, x=cluster)) +
geom_bar(position="stack", stat="identity")+
ylab('Number of TEs')+
theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
RotatedAxis()+
ggtitle('Distance to protein-coding genes')+
#scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5), size = 3.5)
### plot distance
te_distance=read.csv('./data/same_strain_distance_df_for_plot_remove_duplicate_gene_distance_group_with_label.csv',header = T,row.names = 1)
te_distance=te_distance[,c(2,3,4,5,6,7)]
head(te_distance)
#colnames(te_distance)[1]<-'distance'
te_distance$type<-with(te_distance,ifelse(distance>2000,'Distal','Proximal'))
te_distance$cluster_te=paste0(te_distance$cluster,'_',te_distance$te_id)
#te_distance_input<-te_distance[,c(1,2,6,8)]
te_distance_new=te_distance %>%
group_by(cluster_te) %>%
slice_min(order_by = distance)
te_distance_new<-as.data.frame(te_distance_new)
#te_distance_new<-te_distance_new[,c(4,5)]
te_distance_new=as.data.frame(te_distance_new)
write.csv(te_distance_new,'./data/marker_te_cloest_genes_distance_2k_all_gene.csv')
plot_input=te_distance_new %>%
group_by(cluster,type) %>%
count()
library(plyr)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=n/sum(n)*100)
head(plot_input2)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=freq/sum(freq)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(freq) - 0.5 * freq))
plot_input2$label = paste0(sprintf("%.0f", plot_input2$percent), "%")
ggplot(plot_input2, aes(fill=type, y=freq, x=cluster)) +
geom_bar(position="stack", stat="identity")+
ylab('Number of TEs')+
theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
RotatedAxis()+
ggtitle('Distance to protein-coding genes')+
#scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5), size = 3.5)
te_distance_new$gene_open='no'
for (i in 1:12537){
target_gene=gsub("_",'-',te_distance_new$gene_id[i])
target_celltype=te_distance$cluster[i]
target_cells=rownames(CC7@meta.data[CC7@meta.data$Cell_type==target_celltype,])
if (target_gene %in% rownames(CC7)){
target_invest=CC7@assays$RNA[target_gene,target_cells]
if (sum(target_invest)>0) {
te_distance_new$gene_open[i]='yes'
}
}
}
table(te_distance_new$gene_open)
te_distance_new$celltype_gene_open=paste0(te_distance_new$cluster,'_',te_distance_new$gene_open)
te_distance_new<-data.frame(te_distance_new)
#te_distance_new_test<-te_distance_new[,c(10,7)]
te_distance_new$type<-with(te_distance_new,ifelse(distance>5000,'Distal','Proximal'))
#te_distance_new_test<-te_distance_new[,c(10,7)]
te_distance_new$type<-with(te_distance_new,ifelse(distance>2000,'Distal','Proximal'))
a=te_distance_new %>%
group_by(celltype_gene_open,type) %>%
dplyr::summarise(distance_type = n())
a$celltype=gsub('_.*','',a$celltype_gene_open)
a$gene_open=gsub('.*_','',a$celltype_gene_open)
plot_data=a %>%
group_by(celltype_gene_open) %>%
mutate(percent=distance_type/sum(distance_type))
plot_data$gene_open<-gsub('no','TE+Gene-',plot_data$gene_open)
plot_data$gene_open<-gsub('yes','TE+Gene+',plot_data$gene_open)
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5)
target=plot_data[plot_data$celltype==celltype,]
#target=target[,c(2,6,3)]
a=PieDonut(target, aes(type,gene_open,count=distance_type),
title = celltype,explode = 1,showPieName = F,
pieLabelSize = 5,donutLabelSize = 5)
library(Seurat)
library(data.table)
library(ggplot2)
library(dplyr)
library(ggpubr)
### plot distance
te_distance=read.csv('./data/same_strain_distance_df_for_plot_remove_duplicate_gene_distance_group_with_label.csv',header = T,row.names = 1)
te_distance=te_distance[,c(2,3,4,5,6,7)]
#colnames(te_distance)[1]<-'distance'
te_distance$type<-with(te_distance,ifelse(distance>2000,'Distal','Proximal'))
te_distance$cluster_te=paste0(te_distance$cluster,'_',te_distance$te_id)
#te_distance<-te_distance[,c(1,6)]
te_distance_new=te_distance %>%
group_by(cluster_te) %>%
slice_min(order_by = distance)
#te_distance_new$cluster=gsub('_NODE-.*','',te_distance_new$cluster_te)
#te_distance_new$type<-with(te_distance_new,ifelse(distance>2000,'Distal','Proximal'))
te_distance_new<-te_distance_new[!duplicated(te_distance_new$cluster_te),]
#te_distance<-te_distance[,c(1,6)]
te_distance_new=te_distance %>%
group_by(cluster_te) %>%
slice_min(order_by = distance)
#te_distance_new<-te_distance_new[,c(2,5)]
te_distance_new<-as.data.frame(te_distance_new)
dim(te_distance_new)
plot_input=te_distance_new %>%
group_by(cluster,type) %>%
count()
library(plyr)
head(plot_input)
plot_input2<-ddply(plot_input,.(cluster),transform,percent=n/sum(n)*100)
# Format the labels and calculate their positions
plot_input2 = ddply(plot_input2, .(cluster), transform, pos = (cumsum(n) - 0.5 * n))
plot_input2$label = paste0(sprintf("%.00f", plot_input2$percent), "%")
head(plot_input2)
plot_input2$label = paste0(sprintf("%.2f", plot_input2$percent), "%")
head(plot_input2)
ggplot(plot_input2, aes(fill=type, y=n, x=cluster)) +
geom_bar(position="stack", stat="identity")+
ylab('Number of TEs')+
theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
RotatedAxis()+
ggtitle('Distance to protein-coding genes')+
#scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5), size = 3.5)
ggsave('./plots/pure_te_number_TEs_celltype_distance_to_coding_genes_barplot_correct_celltype_groupâ€”allgenes.png')
library(Seurat)
library(data.table)
library(ggplot2)
library(dplyr)
library(ggpubr)
CC7=readRDS('./Ahem_after_annotation.RDS')
SingleRasterMap_Gabs <- function (data, raster = TRUE, cell.order = NULL, feature.order = NULL,
colors = PurpleAndYellow(), disp.min = -2.5, disp.max = 2.5,
limits = NULL, group.by = NULL)
{
data <- MinMax(data = data, min = disp.min, max = disp.max)
data <- mefa4::Melt(x = t(x = data))
colnames(x = data) <- c("Feature", "Cell", "Expression")
if (!is.null(x = feature.order)) {
data$Feature <- factor(x = data$Feature, levels = unique(x = feature.order))
}
if (!is.null(x = cell.order)) {
data$Cell <- factor(x = data$Cell, levels = unique(x = cell.order))
}
if (!is.null(x = group.by)) {
data$Identity <- group.by[data$Cell]
}
limits <- limits %||% c(min(data$Expression), max(data$Expression))
if (length(x = limits) != 2 || !is.numeric(x = limits)) {
stop("limits' must be a two-length numeric vector")
}
my_geom <- ifelse(test = raster, yes = geom_raster, no = geom_tile)
xx <- plyr::ddply(data, ~Feature, summarise, k=mean(abs(Expression), na.rm = T))
xxxx <- plyr::arrange(xx, k)$Feature
#print(xx)
#print(xxxx)
data$Feature = factor(data$Feature, levels = xxxx, ordered = T)
plot <- ggplot(data = data) + my_geom(mapping = aes_string(x = "Cell",
y = "Feature", fill = "Expression")) + theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank()) + scale_fill_gradientn(limits = limits,
colors = colors, na.value = "white") + labs(x = NULL,
y = NULL, fill = group.by %iff% "Expression") + WhiteBackground() +
NoAxes(keep.text = TRUE)
if (!is.null(x = group.by)) {
plot <- plot + geom_point(mapping = aes_string(x = "Cell",
y = "Feature", color = "Identity"), alpha = 0) +
guides(color = guide_legend(override.aes = list(alpha = 1)))
}
return(plot)
}
DoMultiBarHeatmap <- function (object,
features = NULL,
cells = NULL,
group.by = "ident",
additional.group.by = NULL,
additional.group.sort.by = NULL,
cols.use = NULL,
group.bar = TRUE,
disp.min = -2.5,
disp.max = NULL,
slot = "scale.data",
assay = NULL,
label = TRUE,
size = 5.5,
hjust = 0,
angle = 45,
raster = TRUE,
draw.lines = TRUE,
lines.width = NULL,
group.bar.height = 0.02,
combine = TRUE)
{
cells <- cells %||% colnames(x = object)
if (is.numeric(x = cells)) {
cells <- colnames(x = object)[cells]
}
assay <- assay %||% DefaultAssay(object = object)
DefaultAssay(object = object) <- assay
features <- features %||% VariableFeatures(object = object)
## Why reverse???
features <- rev(x = unique(x = features))
disp.max <- disp.max %||% ifelse(test = slot == "scale.data",
yes = 2.5, no = 6)
possible.features <- rownames(x = GetAssayData(object = object,
slot = slot))
if (any(!features %in% possible.features)) {
bad.features <- features[!features %in% possible.features]
features <- features[features %in% possible.features]
if (length(x = features) == 0) {
stop("No requested features found in the ", slot,
" slot for the ", assay, " assay.")
}
warning("The following features were omitted as they were not found in the ",
slot, " slot for the ", assay, " assay: ", paste(bad.features,
collapse = ", "))
}
if (!is.null(additional.group.sort.by)) {
if (any(!additional.group.sort.by %in% additional.group.by)) {
bad.sorts <- additional.group.sort.by[!additional.group.sort.by %in% additional.group.by]
additional.group.sort.by <- additional.group.sort.by[additional.group.sort.by %in% additional.group.by]
if (length(x = bad.sorts) > 0) {
warning("The following additional sorts were omitted as they were not a subset of additional.group.by : ",
paste(bad.sorts, collapse = ", "))
}
}
}
data <- as.data.frame(x = as.matrix(x = t(x = GetAssayData(object = object,
slot = slot)[features, cells, drop = FALSE])))
object <- suppressMessages(expr = StashIdent(object = object,
save.name = "ident"))
group.by <- group.by %||% "ident"
groups.use <- object[[c(group.by, additional.group.by[!additional.group.by %in% group.by])]][cells, , drop = FALSE]
plots <- list()
for (i in group.by) {
data.group <- data
if (!is_null(additional.group.by)) {
additional.group.use <- additional.group.by[additional.group.by!=i]
if (!is_null(additional.group.sort.by)){
additional.sort.use = additional.group.sort.by[additional.group.sort.by != i]
} else {
additional.sort.use = NULL
}
} else {
additional.group.use = NULL
additional.sort.use = NULL
}
group.use <- groups.use[, c(i, additional.group.use), drop = FALSE]
for(colname in colnames(group.use)){
if (!is.factor(x = group.use[[colname]])) {
group.use[[colname]] <- factor(x = group.use[[colname]])
}
}
if (draw.lines) {
lines.width <- lines.width %||% ceiling(x = nrow(x = data.group) *
0.0025)
placeholder.cells <- sapply(X = 1:(length(x = levels(x = group.use[[i]])) *
lines.width), FUN = function(x) {
return(Seurat:::RandomName(length = 20))
})
placeholder.groups <- data.frame(rep(x = levels(x = group.use[[i]]), times = lines.width))
group.levels <- list()
group.levels[[i]] = levels(x = group.use[[i]])
for (j in additional.group.use) {
group.levels[[j]] <- levels(x = group.use[[j]])
placeholder.groups[[j]] = NA
}
colnames(placeholder.groups) <- colnames(group.use)
rownames(placeholder.groups) <- placeholder.cells
group.use <- sapply(group.use, as.vector)
rownames(x = group.use) <- cells
group.use <- rbind(group.use, placeholder.groups)
for (j in names(group.levels)) {
group.use[[j]] <- factor(x = group.use[[j]], levels = group.levels[[j]])
}
na.data.group <- matrix(data = NA, nrow = length(x = placeholder.cells),
ncol = ncol(x = data.group), dimnames = list(placeholder.cells,
colnames(x = data.group)))
data.group <- rbind(data.group, na.data.group)
}
order_expr <- paste0('order(', paste(c(i, additional.sort.use), collapse=','), ')')
group.use = with(group.use, group.use[eval(parse(text=order_expr)), , drop=F])
plot <- SingleRasterMap_Gabs(data = data.group, raster = raster,
disp.min = disp.min, disp.max = disp.max, feature.order = features,
cell.order = rownames(x = group.use), group.by = group.use[[i]])
if (group.bar) {
pbuild <- ggplot_build(plot = plot)
group.use2 <- group.use
cols <- list()
na.group <- Seurat:::RandomName(length = 20)
for (colname in rev(x = colnames(group.use2))) {
if (colname == i) {
colid = paste0('Identity (', colname, ')')
} else {
colid = colname
}
# Default
cols[[colname]] <- c(scales::hue_pal()(length(x = levels(x = group.use[[colname]]))))
#Overwrite if better value is provided
if (!is_null(cols.use[[colname]])) {
req_length = length(x = levels(group.use))
if (length(cols.use[[colname]]) < req_length){
warning("Cannot use provided colors for ", colname, " since there aren't enough colors.")
} else {
if (!is_null(names(cols.use[[colname]]))) {
if (all(levels(group.use[[colname]]) %in% names(cols.use[[colname]]))) {
cols[[colname]] <- as.vector(cols.use[[colname]][levels(group.use[[colname]])])
} else {
warning("Cannot use provided colors for ", colname, " since all levels (", paste(levels(group.use[[colname]]), collapse=","), ") are not represented.")
}
} else {
cols[[colname]] <- as.vector(cols.use[[colname]])[c(1:length(x = levels(x = group.use[[colname]])))]
}
}
}
# Add white if there's lines
if (draw.lines) {
levels(x = group.use2[[colname]]) <- c(levels(x = group.use2[[colname]]), na.group)
group.use2[placeholder.cells, colname] <- na.group
cols[[colname]] <- c(cols[[colname]], "#FFFFFF")
}
names(x = cols[[colname]]) <- levels(x = group.use2[[colname]])
y.range <- diff(x = pbuild$layout$panel_params[[1]]$y.range)
y.pos <- max(pbuild$layout$panel_params[[1]]$y.range) + y.range * 0.015
y.max <- y.pos + group.bar.height * y.range
pbuild$layout$panel_params[[1]]$y.range <- c(pbuild$layout$panel_params[[1]]$y.range[1], y.max)
plot <- suppressMessages(plot +
annotation_raster(raster = t(x = cols[[colname]][group.use2[[colname]]]),  xmin = -Inf, xmax = Inf, ymin = y.pos, ymax = y.max) +
annotation_custom(grob = grid::textGrob(label = colid, hjust = 0, gp = gpar(cex = 0)), ymin = mean(c(y.pos, y.max)), ymax = mean(c(y.pos, y.max)), xmin = Inf, xmax = Inf) +
coord_cartesian(ylim = c(0, y.max), clip = "off"))
if ((colname == i) && label) {
x.max <- max(pbuild$layout$panel_params[[1]]$x.range)
x.divs <- pbuild$layout$panel_params[[1]]$x.major %||% pbuild$layout$panel_params[[1]]$x$break_positions()
group.use$x <- x.divs
label.x.pos <- tapply(X = group.use$x, INDEX = group.use[[colname]],
FUN = median) * x.max
label.x.pos <- data.frame(group = names(x = label.x.pos),
label.x.pos)
plot <- plot + geom_text(stat = "identity",
data = label.x.pos, aes_string(label = "group",
x = "label.x.pos"), y = y.max + y.max *
0.03 * 0.5, angle = angle, hjust = hjust,
size = size)
plot <- suppressMessages(plot + coord_cartesian(ylim = c(0,
y.max + y.max * 0.002 * max(nchar(x = levels(x = group.use[[colname]]))) *
size), clip = "off"))
}
}
}
plot <- plot + theme(line = element_blank())
plots[[i]] <- plot
}
if (combine) {
plots <- CombinePlots(plots = plots)
}
return(plots)
}
